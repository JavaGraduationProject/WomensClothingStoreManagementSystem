<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>衣衣布舍女装网站</title>
    <meta name="robots" content="noindex, follow"/>
    <meta name="描述" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->


    <!-- CSS
	============================================ -->
    <link rel="stylesheet" href="layui/css/layui.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="assets/css/vendor/font.awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="assets/css/vendor/ionicons.min.css">
    <!-- Slick CSS -->
    <link rel="stylesheet" href="assets/css/plugins/slick.min.css">
    <!-- Animation -->
    <link rel="stylesheet" href="assets/css/plugins/animate.min.css">
    <!-- jQuery Ui -->
    <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
    <!-- Nice Select -->
    <link rel="stylesheet" href="assets/css/plugins/nice-select.min.css">
    <!-- Magnific Popup -->
    <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">

    <!-- Vendor & Plugins CSS (Please remove the comment from below vendor.min.css & plugins.min.css for better website load performance and remove css files from the above) -->

    <!-- <link rel="stylesheet" href="assets/css/vendor/vendor.min.css">
    <link rel="stylesheet" href="assets/css/plugins/plugins.min.css"> -->

    <!-- Main Style CSS (Please use minify version for better website load performance) -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- <link rel="stylesheet" href="assets/css/style.min.css"> -->

    <style>
        .login-register-wrapper .single-input-item select{
            background: #ffffff none repeat scroll 0 0;
            border: medium none rgba(0, 0, 0, 0);
            border-radius: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
            color: #1B1B1C;
            font-size: 14px;
            height: 40px;
            margin-bottom: 20px;
            padding-left: 10px;
            padding-right: 10px;
            width: 100%;
        }
    </style>
</head>

<body>

<div class="contact-wrapper">
    <header class="main-header-area">
        <div id="topiframe"></div>
        <!-- Main Header Area Start -->

        <!-- Main Header Area End -->
        <!-- Sticky Header Start Here-->

        <!-- Sticky Header End Here -->
        <!-- off-canvas menu start -->

        <!-- off-canvas menu end -->
    </header>
    <!-- Breadcrumb Area Start Here -->
    <div class="breadcrumbs-area position-relative" style="background: url('upload/banner.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <div class="breadcrumb-content position-relative section-content">
                        <h3 class="title-3">个人信息</h3>
                        <ul>
                            <li><a href="index.html">首页</a></li>
                            <li>个人信息</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb Area End Here -->
    <!-- Login Area Start Here -->
    <div class="login-register-area mt-no-text mb-no-text" id="app">
        <div class="container container-default-2 custom-area">
            <div class="row">
                <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-custom">
                    <div class="login-register-wrapper">
                        <!--<div class="section-content text-center mb-5">-->
                        <!--<h2 class="title-4 mb-2">登录</h2>-->
                        <!--<p class="desc-content">请使用下面的帐户详细信息登录。</p>-->
                        <!--</div>-->

                        <div class="single-input-item mb-3">
                            <div class="layui-upload">
                                <div class="layui-upload-list">
                                    <input type="hidden" v-model="member.filename" id="filename" value="noimg.jpg"/>
                                    <img class="layui-upload-img" id="imgname" style="width: 10%">
                                    <p id="demoText"></p>
                                </div>
                                <button style="background: #E98C81" type="button" class="layui-btn" id="test1"><i class="layui-icon"></i>上传头像</button>
                            </div>
                        </div>


                        <div class="single-input-item mb-3">
                            <input type="text" id="uname" v-model="member.uname" readonly placeholder="用户名">
                        </div>


                        <div class="single-input-item mb-3">
                            <input type="password" id="upass" v-model="member.upass" placeholder="密码">
                        </div>


                        <div class="single-input-item mb-3">
                            <input type="text" id="tname" v-model="member.tname" placeholder="姓名">
                        </div>


                        <div class="single-input-item mb-3">
                            <select v-model="member.sex">
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>

                        <div class="single-input-item mb-3">
                            <input type="text" id="birthtime" v-model="member.birthtime" placeholder="生日">
                        </div>

                        <div class="single-input-item mb-3">
                            <input type="text" id="tel" v-model="member.tel" placeholder="电话">
                        </div>

                        <div class="single-input-item mb-3">
                            <input type="text" id="email" v-model="member.email" placeholder="邮箱">
                        </div>


                        <div class="single-input-item mb-3">
                            <button class="btn obrien-button-2 primary-color" @click="add()">提交</a></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Login Area End Here -->
    <!-- Support Area Start Here -->
    <div class="support-area">

    </div>
    <!-- Support Area End Here -->
    <!-- Footer Area Start Here -->
    <footer class="footer-area">
        <div class="footer-copyright-area" id="footiframe">
        </div>
    </footer>
    <!-- Footer Area End Here -->
</div>

<!-- JS
============================================ -->

<!-- jQuery JS -->
<script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
<!-- jQuery Migrate JS -->
<script src="assets/js/vendor/jQuery-migrate-3.3.0.min.js"></script>
<!-- Modernizer JS -->
<script src="assets/js/vendor/modernizr-2.8.3.min.js"></script>
<!-- Bootstrap JS -->
<script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
<!-- Slick Slider JS -->
<script src="assets/js/plugins/slick.min.js"></script>
<!-- Countdown JS -->
<script src="assets/js/plugins/jquery.countdown.min.js"></script>
<!-- Ajax JS -->
<script src="assets/js/plugins/jquery.ajaxchimp.min.js"></script>
<!-- Jquery Nice Select JS -->
<script src="assets/js/plugins/jquery.nice-select.min.js"></script>
<!-- Jquery Ui JS -->
<script src="assets/js/plugins/jquery-ui.min.js"></script>
<!-- jquery magnific popup js -->
<script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>

<!-- Main JS -->
<script src="assets/js/main.js"></script>


<script type="text/javascript" src="axios/vue.js"></script>
<script type="text/javascript" src="axios/axios.min.js"></script>
<script type="text/javascript" src="axios/qs.js"></script>
<script type="text/javascript" src="axios/getUrlParams.js"></script>
<script type="text/javascript" src="layer/layer.js"></script>
<script type="text/javascript" src="laydate/laydate.js"></script>
<script type="text/javascript" src="layui/layui.js"></script>


<script type="text/javascript">

    var qs = Qs
    var vmm = new Vue({
        el: "#app",
        data: {
            member:{
                uname:"",
                upass:"",
                tname:"",
                sex:"男",
                birthtime:"",
                tel:"",
                email:"",
                filename:"",
                id:"",
            }
        },
        mounted() {
            if(sessionStorage.getItem("uname")==null){
                location.replace("login.html")
                return;
            }
            this.show()
            this.$nextTick(function(){
                var img = "";
                layui.use(['form', 'layer', 'upload'], function () {
                    $ = layui.jquery;
                    var form = layui.form
                        , layer = layui.layer
                        , upload = layui.upload;

                    //普通图片上传
                    layui.use('upload', function () {
                        var $ = layui.jquery
                            , upload = layui.upload;

                        //普通图片上传
                        var uploadInst = upload.render({
                            elem: '#test1'
                            , url: 'admin/uploadImg'
                            , accept: 'images'
                            , size: 50000
                            , before: function (obj) {

                                obj.preview(function (index, file, result) {
                                    $('#imgname').attr('src', result);
                                });
                            }
                            , done: function (res) {
                                //如果上传失败
                                if (res.code > 0) {
                                    return layer.msg('上传失败');
                                }
                                //上传成功
                                var demoText = $('#demoText');
                                demoText.html('<span style="color: #4cae4c;">上传成功</span>');
                                var fileupload = $(".image");
                                fileupload.attr("value", res.data.src);
                                // $("#filename").val(res.data.src)
                                vmm.member.filename = res.data.src
                                //console.log(fileupload.attr("value"));
                                console.log(res.data.src);
                                img = res.data.src;
                            }
                            , error: function () {
                                //演示失败状态，并实现重传
                                var demoText = $('#demoText');
                                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                                demoText.find('.demo-reload').on('click', function () {
                                    uploadInst.upload();
                                });
                            }
                        });
                    });
                });



                //执行一个laydate实例
                laydate.render({
                    elem: '#birthtime',
                    done:function(value){
                        vmm.member.birthtime = value
                    }
                });

            })
        },
        methods: {
            show(){
                axios.post('memberShow',qs.stringify({
                })).then(response =>{
                    this.member = response.data.member
                    $('#imgname').attr('src', "upload/"+this.member.filename); //图片链接（base64）
                }).catch(error =>{
                    console.log(error)
                })
            },
            add() {

                if(this.member.uname==""){
                    layer.msg("用户名不能为空",{icon:5})
                    return false;
                }
                if(this.member.upass==""){
                    layer.msg("密码不能为空",{icon:5})
                    return false;
                }
                if(this.member.tname==""){
                    layer.msg("姓名不能为空",{icon:5})
                    return false;
                }
                if(this.member.brithtime==""){
                    layer.msg("生日不能为空",{icon:5})
                    return false;
                }
                if(!/^[1][3,4,5,7,8][0-9]{9}$/.test(this.member.tel)){
                    layer.msg("电话输入错误",{icon:5})
                    return false;
                }
                if(!/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(this.member.email)){
                    layer.msg("邮箱输入错误",{icon:5})
                    return false;
                }
                axios.post('memberEdit',qs.stringify({
                    upass:this.member.upass,
                    tname:this.member.tname,
                    sex:this.member.sex,
                    birthtime:this.member.birthtime,
                    tel:this.member.tel,
                    filename:this.member.filename,
                    email:this.member.email,
                    id:this.member.id,
                })).then(response =>{
                    layer.msg("编辑成功",{icon:6})
                }).catch(error =>{
                    console.log(error)
                })
            },

        }
    })


    window.onload = function () {
        $("#topiframe").load("iframe/topiframe.html")
        $("#footiframe").load("iframe/footiframe.html")
    }
</script>

</body>

</html>
